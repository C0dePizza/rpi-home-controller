<!doctype html>
<html lang=''>
<head>
   <meta charset='utf-8'>
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="styles.css">
   <link rel="stylesheet" type="text/css" href="switches.css">
   <link rel="stylesheet" type="text/css" href="custom.css">
   <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
   <script src="script.js"></script>
   <title>Control Panel</title>
    
    
    
    <script type="text/javascript">
         var socket = null;
         var isopen = false;
        
        
         var get_switch_stats = function() {
            for (var x = 1; x<9 ; x++) {
                socket.send("PIN=" + document.getElementsByTagName('input')[x].name + ",IN,0")
            }
         }
         window.onload = function() {
            socket = new WebSocket("ws://192.168.1.230:9000");
            socket.binaryType = "arraybuffer";
            socket.onopen = function() {
               console.log("Connected!");
               isopen = true;
               get_switch_stats()
            }
            socket.onmessage = function(e) {
               if (typeof e.data == "string") {
                    console.log("Message received: " + e.data);
                    if (e.data.split(" ")[0] === "PIN") {
                        var pin_number = e.data.split(" ")[1]
                        var pin_status = e.data.split(" ")[2]
                        var pin_switch = (document.getElementsByName(pin_number)[0])
                        if (pin_status === "0") {
                            pin_switch.checked = true
                        } else if (pin_status === "1") {
                            pin_switch.checked = false
                        }
                    }
               }
            }
            socket.onclose = function(e) {
               console.log("Connection closed.");
               socket = null;
               isopen = false;
            }
         };
         function sendText() {
            if (isopen) {
               socket.send("Hello, world!");
               console.log("Text message sent.");               
            } else {
               console.log("Connection not opened.")
            }
         };
        
//        begin custom stuff
        
        var switch_onclick = function(box) {
            if (box.checked === true) {
                socket.send('PIN=' + box.name + ',OUT,0')
            }
            else if (box.checked === false) {
                socket.send('PIN=' + box.name + ',OUT,1')
            }
        }
        var master_switch_onclick = function(box) {
            if (box.checked === true) {
                socket.send('ALLRELAYS=0')
            }
            else if (box.checked === false) {
                socket.send('ALLRELAYS=1')
            }
        }
        

        
      </script>
</head>
<body>


<div id='navbar'>
<ul>
   <li class='active'><a href='#'><span>Home</span></a></li>
   <li><a href='#'><span>Settings</span></a></li>
   <li><a href='https://github.com/therealtylerdurden/rpi-home-automation-server'><span>GitHub</span></a></li>
   <li><a href='#'><span>About</span></a></li>
</ul>
</div>

<!-- begin "body" -->

<!-- switch div naming/id scheme: name=(gpio pin number) id=(Text above switch eg. "TV") -->

<div id='content'>
   <div class='switchgroup'>
      <p>The Master Switch</p>
      <div class="onoffswitch">
          <input type="checkbox" name="-" class="onoffswitch-checkbox" id="0" onclick="master_switch_onclick(this)">
          <label class="onoffswitch-label" for="0">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>

   <div class='switchgroup'>
      <p>1</p>
      <div class="onoffswitch">
          <input type="checkbox" name="40" class="onoffswitch-checkbox" id="1" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="1">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>


   <div class='switchgroup'>
      <p>2</p>
      <div class="onoffswitch">
          <input type="checkbox" name="22" class="onoffswitch-checkbox" id="2" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="2">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>
   </div>

   <div class='switchgroup'>
      <p>3</p>
      <div class="onoffswitch">
          <input type="checkbox" name="18" class="onoffswitch-checkbox" id="3" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="3">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>
   
   <div class='switchgroup'>
      <p>4</p>
      <div class="onoffswitch">
          <input type="checkbox" name="15" class="onoffswitch-checkbox" id="4" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="4">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>
   
   
   <div class='switchgroup'>
      <p>5</p>
      <div class="onoffswitch">
          <input type="checkbox" name="13" class="onoffswitch-checkbox" id="5" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="5">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>


   <div class='switchgroup'>
      <p>6</p>
      <div class="onoffswitch">
          <input type="checkbox" name="12" class="onoffswitch-checkbox" id="6" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="6">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>
   </div>

   <div class='switchgroup'>
      <p>7</p>
      <div class="onoffswitch">
          <input type="checkbox" name="11" class="onoffswitch-checkbox" id="7" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="7">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>
   
   <div class='switchgroup'>
      <p>8</p>
      <div class="onoffswitch">
          <input type="checkbox" name="7" class="onoffswitch-checkbox" id="8" onclick="switch_onclick(this)">
          <label class="onoffswitch-label" for="8">
              <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
              </span>
          </label>
      </div>   
   </div>
</div>

    
    
<!--
<script type="text/javascript">
	var connection = new WebSocket('ws://pi:8080', ['soap', 'xmpp']);
	connection.onopen = function () {
  		alert('connected!')
    };
  
    connection.onmessage = function(e){
       var server_message = e.data;
       console.log(server_message);
    }
    
	var switch_onclick = function(box) {
		if (box.checked === true) {
            connection.send('PIN=' + box.name + ',OUT,0')
        }
        else if (box.checked === false) {
            connection.send('PIN=' + box.name + ',OUT,1')
        }
	}
</script>
-->
    

    
</body>
<html>
